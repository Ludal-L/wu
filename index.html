<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº”å­æ£‹ - ç»å…¸å¯¹æˆ˜</title>
    <!-- å¼•å…¥Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥Font Awesomeå›¾æ ‡ -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- é…ç½®Tailwindè‡ªå®šä¹‰é¢œè‰²å’Œå­—ä½“ -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',      // ä¸»è‰²è°ƒï¼šè…¾è®¯è“
                        secondary: '#FF7D00',    // è¾…åŠ©è‰²ï¼šæ©™è‰²
                        dark: '#1D2129',         // æ·±è‰²èƒŒæ™¯
                        board: '#E6B86C',        // æ£‹ç›˜é¢œè‰²
                        black: '#000000',        // é»‘å­
                        white: '#FFFFFF',        // ç™½å­
                    },
                    fontFamily: {
                        sans: ['PingFang SC', 'Microsoft YaHei', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <!-- è‡ªå®šä¹‰å·¥å…·ç±» -->
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .text-shadow-lg {
                text-shadow: 0 4px 8px rgba(0,0,0,0.2);
            }
            .board-grid {
                background-image: linear-gradient(to right, #000 1px, transparent 1px),
                                linear-gradient(to bottom, #000 1px, transparent 1px);
            }
            .animate-float {
                animation: float 3s ease-in-out infinite;
            }
            .animate-pulse-slow {
                animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
            }
        }
        
        /* è‡ªå®šä¹‰åŠ¨ç”» */
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes victory {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .victory-animation {
            animation: victory 1s ease-out forwards;
        }
    </style>
</head>
<body class="bg-dark text-white overflow-hidden h-screen font-sans">
    <!-- æ¸¸æˆå°é¢ -->
    <div id="cover" class="absolute inset-0 z-50 flex flex-col items-center justify-center transition-opacity duration-1000">
        <!-- å°é¢GIFå›¾ -->
        <div class="absolute inset-0 bg-cover bg-center" style="background-image: url('https://1318328187.vod2.myqcloud.com/3dcdd3b3vodsh1318328187/1a5e2d145145403692182000319/Ac5Yi6gQKqwA.gif'); filter: brightness(0.7);">
            <!-- è¿™é‡Œæ›¿æ¢ä¸ºæ‚¨è‡ªå·±çš„å°é¢GIFå›¾ -->
            <!-- <img src="æ‚¨çš„å°é¢GIFå›¾è·¯å¾„" alt="äº”å­æ£‹å°é¢" class="w-full h-full object-cover"> -->
        </div>
        
        <!-- å°é¢å†…å®¹ -->
        <div class="relative z-10 text-center px-4">
            <h1 class="text-[clamp(2.5rem,8vw,5rem)] font-bold mb-6 text-shadow-lg animate-float"></h1>
            <p class="text-[clamp(1rem,3vw,1.5rem)] mb-10 max-w-lg mx-auto text-shadow">
                æŒ‘æˆ˜é²æ£‹åœ£ï¼Œä½“éªŒç»å…¸å¯¹æˆ˜ä¹è¶£
            </p>
            <button id="startBtn" class="bg-primary hover:bg-primary/90 text-white font-bold py-4 px-10 rounded-full text-[clamp(1rem,3vw,1.25rem)] transform transition hover:scale-105 focus:outline-none focus:ring-4 focus:ring-primary/50 shadow-lg animate-pulse-slow">
                å¼€å§‹æ¸¸æˆ <i class="fa fa-play ml-2"></i>
            </button>
        </div>
    </div>

    <!-- æ¸¸æˆä¸»ç•Œé¢ -->
    <div id="game" class="absolute inset-0 z-10 hidden flex flex-col">
        <!-- æ¸¸æˆé¡¶éƒ¨å¯¼èˆª -->
        <header class="bg-dark/80 backdrop-blur-md p-4 flex justify-between items-center border-b border-gray-700">
            <div class="flex items-center">
                <button id="backBtn" class="text-white hover:text-primary transition p-2">
                    <i class="fa fa-arrow-left text-xl"></i>
                </button>
                <h2 class="ml-4 text-xl font-bold">äº”å­æ£‹å¯¹æˆ˜</h2>
            </div>
            
            <div class="flex items-center space-x-4">
                <button id="soundBtn" class="text-white hover:text-primary transition p-2">
                    <i class="fa fa-volume-up text-xl"></i>
                </button>
                <button id="restartBtn" class="bg-primary/20 hover:bg-primary/30 text-primary px-4 py-2 rounded-lg transition">
                    <i class="fa fa-refresh mr-1"></i> é‡æ–°å¼€å§‹
                </button>
            </div>
        </header>
        
        <!-- æ¸¸æˆéš¾åº¦é€‰æ‹© (åˆå§‹æ˜¾ç¤º) -->
        <div id="difficultySelect" class="flex-1 flex flex-col items-center justify-center p-6">
            <h3 class="text-[clamp(1.5rem,5vw,2.5rem)] font-bold mb-10 text-center">é€‰æ‹©éš¾åº¦</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 w-full max-w-2xl">
                <button class="difficulty-btn bg-primary/20 hover:bg-primary/40 transition-all duration-300 rounded-xl p-6 text-center transform hover:scale-105" data-level="1">
                    <div class="text-5xl mb-4">ğŸ¥‰</div>
                    <h4 class="text-xl font-bold mb-2">ç®€å•</h4>
                    <p class="text-gray-400">é€‚åˆæ–°æ‰‹ç©å®¶</p>
                </button>
                
                <button class="difficulty-btn bg-primary/20 hover:bg-primary/40 transition-all duration-300 rounded-xl p-6 text-center transform hover:scale-105" data-level="2">
                    <div class="text-5xl mb-4">ğŸ¥ˆ</div>
                    <h4 class="text-xl font-bold mb-2">ä¸€èˆ¬</h4>
                    <p class="text-gray-400">æœ‰ä¸€å®šæŒ‘æˆ˜æ€§</p>
                </button>
                
                <button class="difficulty-btn bg-primary/20 hover:bg-primary/40 transition-all duration-300 rounded-xl p-6 text-center transform hover:scale-105" data-level="3">
                    <div class="text-5xl mb-4">ğŸ¥‡</div>
                    <h4 class="text-xl font-bold mb-2">å›°éš¾</h4>
                    <p class="text-gray-400">é«˜æ‰‹æŒ‘æˆ˜</p>
                </button>
            </div>
        </div>
        
        <!-- æ¸¸æˆæ£‹ç›˜åŒºåŸŸ (åˆå§‹éšè—) -->
        <div id="gameBoardContainer" class="flex-1 flex flex-col items-center justify-center p-4 hidden">
            <!-- æ¸¸æˆä¿¡æ¯ -->
            <div class="mb-4 flex justify-between items-center w-full max-w-md">
                <div class="flex items-center">
                    <div class="w-6 h-6 bg-black rounded-full mr-2"></div>
                    <span>ç©å®¶</span>
                </div>
                <div id="gameStatus" class="text-primary font-medium">æ¸¸æˆè¿›è¡Œä¸­</div>
                <div class="flex items-center">
                    <div class="w-6 h-6 bg-white border border-gray-600 rounded-full mr-2"></div>
                    <span>ç”µè„‘</span>
                </div>
            </div>
            
            <!-- æ£‹ç›˜å®¹å™¨ -->
            <div class="relative">
                <!-- æ£‹ç›˜èƒŒæ™¯ -->
                <div id="board" class="bg-board rounded-lg board-grid shadow-2xl overflow-hidden">
                    <!-- æ£‹å­å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <!-- èƒœåˆ©ä¿¡æ¯ (åˆå§‹éšè—) -->
                <div id="victoryMessage" class="absolute inset-0 flex items-center justify-center bg-black/50 backdrop-blur-sm rounded-lg hidden">
                    <div class="text-center p-6 rounded-xl bg-dark/90 victory-animation">
                        <h3 id="victoryText" class="text-[clamp(1.5rem,5vw,3rem)] font-bold mb-6"></h3>
                        <button id="playAgainBtn" class="bg-primary hover:bg-primary/90 text-white font-bold py-3 px-8 rounded-full transition transform hover:scale-105">
                            å†æ¥ä¸€å±€
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- æ“ä½œæŒ‰é’® -->
            <div class="mt-6 flex space-x-4">
                <button id="undoBtn" class="bg-gray-700/50 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition">
                    <i class="fa fa-undo mr-1"></i> æ‚”æ£‹
                </button>
                <button id="changeDifficultyBtn" class="bg-secondary hover:bg-secondary/90 text-white px-4 py-2 rounded-lg transition">
                    <i class="fa fa-sliders mr-1"></i> æ›´æ¢éš¾åº¦
                </button>
            </div>
        </div>
    </div>

    <!-- éŸ³æ•ˆå…ƒç´  (éšè—) -->
    <audio id="https://1318328187.vod2.myqcloud.com/3dcdd3b3vodsh1318328187/d9c3be035145403692245906490/PLnHfKCuhxQA.mp3" loop>
        <!-- æ›¿æ¢ä¸ºæ‚¨çš„å°é¢èƒŒæ™¯éŸ³ä¹ -->
        <source src="" type="audio/mpeg">
    </audio>
    <audio id="https://1318328187.vod2.myqcloud.com/3dcdd3b3vodsh1318328187/b66016e71397757904325548003/lKlUeAWpOsMA.mp3" loop>
        <!-- æ›¿æ¢ä¸ºæ‚¨çš„æ¸¸æˆèƒŒæ™¯éŸ³ä¹ -->
        <source src="" type="audio/mpeg">
    </audio>
    <audio id="https://1318328187.vod2.myqcloud.com/3dcdd3b3vodsh1318328187/499adcee1397757904327283822/q3mrjh5sJrgA.mp3">
        <!-- æ›¿æ¢ä¸ºæ‚¨çš„è½å­éŸ³æ•ˆ -->
        <source src="" type="audio/mpeg">
    </audio>
    <audio id="winSound">
        <!-- æ›¿æ¢ä¸ºæ‚¨çš„èƒœåˆ©éŸ³æ•ˆ -->
        <source src="" type="audio/mpeg">
    </audio>

    <script>
        // æ¸¸æˆé…ç½®
        const config = {
            boardSize: 15,       // 15x15çš„æ£‹ç›˜
            cellSize: 0,         // å•å…ƒæ ¼å¤§å°ï¼Œå°†åœ¨åˆå§‹åŒ–æ—¶è®¡ç®—
            difficulty: 1,       // é»˜è®¤éš¾åº¦ï¼šç®€å•
            soundEnabled: true   // é»˜è®¤å¼€å¯éŸ³æ•ˆ
        };
        
        // æ¸¸æˆçŠ¶æ€
        const gameState = {
            board: [],           // æ£‹ç›˜æ•°æ®ï¼Œ0:ç©º, 1:ç©å®¶(é»‘), 2:ç”µè„‘(ç™½)
            currentPlayer: 1,    // å½“å‰ç©å®¶ï¼Œ1:ç©å®¶, 2:ç”µè„‘
            gameOver: false,     // æ¸¸æˆæ˜¯å¦ç»“æŸ
            history: []          // è½å­å†å²ï¼Œç”¨äºæ‚”æ£‹
        };
        
        // DOMå…ƒç´ 
        const elements = {
            cover: document.getElementById('cover'),
            game: document.getElementById('game'),
            startBtn: document.getElementById('startBtn'),
            backBtn: document.getElementById('backBtn'),
            soundBtn: document.getElementById('soundBtn'),
            restartBtn: document.getElementById('restartBtn'),
            difficultySelect: document.getElementById('difficultySelect'),
            difficultyBtns: document.querySelectorAll('.difficulty-btn'),
            gameBoardContainer: document.getElementById('gameBoardContainer'),
            board: document.getElementById('board'),
            gameStatus: document.getElementById('gameStatus'),
            victoryMessage: document.getElementById('victoryMessage'),
            victoryText: document.getElementById('victoryText'),
            playAgainBtn: document.getElementById('playAgainBtn'),
            undoBtn: document.getElementById('undoBtn'),
            changeDifficultyBtn: document.getElementById('changeDifficultyBtn'),
            
            // éŸ³æ•ˆå…ƒç´ 
            coverMusic: document.getElementById('coverMusic'),
            gameMusic: document.getElementById('gameMusic'),
            placeSound: document.getElementById('placeSound'),
            winSound: document.getElementById('winSound')
        };
        
        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            // åˆå§‹åŒ–æ£‹ç›˜æ•°æ®
            gameState.board = Array(config.boardSize).fill().map(() => Array(config.boardSize).fill(0));
            gameState.currentPlayer = 1;
            gameState.gameOver = false;
            gameState.history = [];
            
            // è®¡ç®—å•å…ƒæ ¼å¤§å°ï¼ˆæ ¹æ®å±å¹•å°ºå¯¸è‡ªé€‚åº”ï¼‰
            calculateCellSize();
            
            // æ¸²æŸ“æ£‹ç›˜
            renderBoard();
            
            // æ›´æ–°æ¸¸æˆçŠ¶æ€æ˜¾ç¤º
            updateGameStatus();
            
            // éšè—èƒœåˆ©ä¿¡æ¯
            elements.victoryMessage.classList.add('hidden');
        }
        
        // è®¡ç®—å•å…ƒæ ¼å¤§å°
        function calculateCellSize() {
            // è·å–å¯ç”¨ç©ºé—´
            const maxWidth = window.innerWidth - 40;  // å‡å»è¾¹è·
            const maxHeight = window.innerHeight * 0.7;  // ä½¿ç”¨70%çš„é«˜åº¦
            
            // è®¡ç®—æœ€å¤§å¯èƒ½çš„å•å…ƒæ ¼å¤§å°
            const maxCellSizeByWidth = maxWidth / config.boardSize;
            const maxCellSizeByHeight = maxHeight / config.boardSize;
            
            // å–è¾ƒå°çš„å€¼ä½œä¸ºå•å…ƒæ ¼å¤§å°ï¼Œç¡®ä¿æ£‹ç›˜èƒ½å®Œå…¨æ˜¾ç¤º
            config.cellSize = Math.floor(Math.min(maxCellSizeByWidth, maxCellSizeByHeight));
            
            // è®¾ç½®æ£‹ç›˜å¤§å°
            const boardSize = config.cellSize * config.boardSize;
            elements.board.style.width = `${boardSize}px`;
            elements.board.style.height = `${boardSize}px`;
            
            // è®¾ç½®æ£‹ç›˜ç½‘æ ¼èƒŒæ™¯
            elements.board.style.backgroundSize = `${config.cellSize}px ${config.cellSize}px`;
        }
        
        // æ¸²æŸ“æ£‹ç›˜
        function renderBoard() {
            // æ¸…ç©ºæ£‹ç›˜
            elements.board.innerHTML = '';
            
            // åˆ›å»ºæ£‹ç›˜å•å…ƒæ ¼
            for (let y = 0; y < config.boardSize; y++) {
                for (let x = 0; x < config.boardSize; x++) {
                    const cell = document.createElement('div');
                    cell.classList.add('absolute', 'cursor-pointer', 'transition-all', 'duration-200', 'hover:bg-black/10');
                    cell.style.width = `${config.cellSize}px`;
                    cell.style.height = `${config.cellSize}px`;
                    cell.style.left = `${x * config.cellSize}px`;
                    cell.style.top = `${y * config.cellSize}px`;
                    cell.dataset.x = x;
                    cell.dataset.y = y;
                    
                    // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                    cell.addEventListener('click', () => handleCellClick(x, y));
                    
                    elements.board.appendChild(cell);
                    
                    // å¦‚æœæœ‰æ£‹å­ï¼Œæ¸²æŸ“æ£‹å­
                    if (gameState.board[y][x] !== 0) {
                        renderPiece(x, y, gameState.board[y][x]);
                    }
                }
            }
            
            // æ·»åŠ æ£‹ç›˜ä¸Šçš„äº”ä¸ªå°åœ†ç‚¹ï¼ˆä¼ ç»Ÿäº”å­æ£‹æ£‹ç›˜æ ‡è®°ï¼‰
            const dots = [
                {x: 3, y: 3},
                {x: 3, y: 11},
                {x: 7, y: 7},
                {x: 11, y: 3},
                {x: 11, y: 11}
            ];
            
            dots.forEach(dot => {
                const dotElement = document.createElement('div');
                dotElement.classList.add('absolute', 'bg-black', 'rounded-full');
                dotElement.style.width = '8px';
                dotElement.style.height = '8px';
                dotElement.style.left = `${dot.x * config.cellSize + config.cellSize/2 - 4}px`;
                dotElement.style.top = `${dot.y * config.cellSize + config.cellSize/2 - 4}px`;
                dotElement.style.zIndex = '1';
                elements.board.appendChild(dotElement);
            });
        }
        
        // æ¸²æŸ“æ£‹å­
        function renderPiece(x, y, player) {
            const piece = document.createElement('div');
            piece.classList.add('absolute', 'rounded-full', 'transition-all', 'duration-300', 'transform', 'scale-0', 'shadow-lg');
            
            // è®¾ç½®æ£‹å­å¤§å°ï¼ˆæ¯”å•å…ƒæ ¼å°ä¸€ç‚¹ï¼‰
            const pieceSize = config.cellSize * 0.8;
            piece.style.width = `${pieceSize}px`;
            piece.style.height = `${pieceSize}px`;
            
            // è®¡ç®—ä½ç½®ï¼Œä½¿æ£‹å­å±…ä¸­
            piece.style.left = `${x * config.cellSize + (config.cellSize - pieceSize) / 2}px`;
            piece.style.top = `${y * config.cellSize + (config.cellSize - pieceSize) / 2}px`;
            
            // è®¾ç½®æ£‹å­é¢œè‰²
            if (player === 1) {
                piece.classList.add('bg-black');
            } else {
                piece.classList.add('bg-white', 'border', 'border-gray-300');
            }
            
            // æ·»åŠ åˆ°æ£‹ç›˜
            elements.board.appendChild(piece);
            
            // æ·»åŠ åŠ¨ç”»æ•ˆæœ
            setTimeout(() => {
                piece.classList.remove('scale-0');
                piece.classList.add('scale-100');
            }, 10);
            
            // æ’­æ”¾è½å­éŸ³æ•ˆ
            playSound(elements.placeSound);
        }
        
        // å¤„ç†å•å…ƒæ ¼ç‚¹å‡»
        function handleCellClick(x, y) {
            // å¦‚æœæ¸¸æˆç»“æŸï¼Œæˆ–è€…ä¸æ˜¯ç©å®¶å›åˆï¼Œæˆ–è€…å·²æœ‰æ£‹å­ï¼Œåˆ™ä¸å¤„ç†
            if (gameState.gameOver || gameState.currentPlayer !== 1 || gameState.board[y][x] !== 0) {
                return;
            }
            
            // ç©å®¶è½å­
            placePiece(x, y, 1);
            
            // æ£€æŸ¥ç©å®¶æ˜¯å¦è·èƒœ
            if (checkWin(x, y, 1)) {
                gameState.gameOver = true;
                showVictoryMessage(true);
                return;
            }
            
            // åˆ‡æ¢åˆ°ç”µè„‘å›åˆ
            gameState.currentPlayer = 2;
            updateGameStatus('ç”µè„‘æ€è€ƒä¸­...');
            
            // ç”µè„‘å»¶è¿Ÿè½å­ï¼Œå¢åŠ æ€è€ƒæ„Ÿ
            setTimeout(() => {
                computerMove();
            }, 500 + Math.random() * 500);
        }
        
        // è½å­
        function placePiece(x, y, player) {
            // æ›´æ–°æ£‹ç›˜æ•°æ®
            gameState.board[y][x] = player;
            
            // è®°å½•å†å²
            gameState.history.push({x, y, player});
            
            // æ¸²æŸ“æ£‹å­
            renderPiece(x, y, player);
        }
        
        // ç”µè„‘è½å­
        function computerMove() {
            // æ ¹æ®éš¾åº¦è®¡ç®—ç”µè„‘è½å­ä½ç½®
            let x, y;
            
            if (config.difficulty === 1) {
                // ç®€å•éš¾åº¦ï¼šéšæœºè½å­ï¼Œä½†ä¼šä¼˜å…ˆé˜²å®ˆ
                [x, y] = getEasyMove();
            } else if (config.difficulty === 2) {
                // ä¸€èˆ¬éš¾åº¦ï¼šæœ‰ä¸€å®šçš„è¿›æ”»å’Œé˜²å®ˆèƒ½åŠ›
                [x, y] = getMediumMove();
            } else {
                // å›°éš¾éš¾åº¦ï¼šè¾ƒå¼ºçš„AIç®—æ³•
                [x, y] = getHardMove();
            }
            
            // ç”µè„‘è½å­
            placePiece(x, y, 2);
            
            // æ£€æŸ¥ç”µè„‘æ˜¯å¦è·èƒœ
            if (checkWin(x, y, 2)) {
                gameState.gameOver = true;
                showVictoryMessage(false);
                return;
            }
            
            // åˆ‡æ¢å›ç©å®¶å›åˆ
            gameState.currentPlayer = 1;
            updateGameStatus();
        }
        
        // ç®€å•éš¾åº¦AI
        function getEasyMove() {
            // å…ˆæ£€æŸ¥æ˜¯å¦æœ‰èƒ½ç«‹å³è·èƒœçš„ä½ç½®
            const winMove = findWinningMove(2);
            if (winMove) return winMove;
            
            // å†æ£€æŸ¥æ˜¯å¦éœ€è¦é˜²å®ˆï¼ˆç©å®¶å³å°†è·èƒœï¼‰
            const defenseMove = findWinningMove(1);
            if (defenseMove) return defenseMove;
            
            // å¦åˆ™éšæœºè½å­
            return getRandomMove();
        }
        
        // ä¸€èˆ¬éš¾åº¦AI
        function getMediumMove() {
            // å…ˆæ£€æŸ¥æ˜¯å¦æœ‰èƒ½ç«‹å³è·èƒœçš„ä½ç½®
            const winMove = findWinningMove(2);
            if (winMove) return winMove;
            
            // å†æ£€æŸ¥æ˜¯å¦éœ€è¦é˜²å®ˆï¼ˆç©å®¶å³å°†è·èƒœï¼‰
            const defenseMove = findWinningMove(1);
            if (defenseMove) return defenseMove;
            
            // å¯»æ‰¾æœ‰æ½œåŠ›çš„è¿›æ”»ä½ç½®ï¼ˆèƒ½å½¢æˆæ´»ä¸‰ç­‰ï¼‰
            const offensiveMove = findOffensiveMove();
            if (offensiveMove) return offensiveMove;
            
            // å¦åˆ™åœ¨ä¸­å¿ƒåŒºåŸŸé™„è¿‘è½å­
            return getRandomMoveNearCenter();
        }
        
        // å›°éš¾éš¾åº¦AIï¼ˆç®€åŒ–ç‰ˆï¼Œå®é™…ä¼šæ›´å¤æ‚ï¼‰
        function getHardMove() {
            // å…ˆæ£€æŸ¥æ˜¯å¦æœ‰èƒ½ç«‹å³è·èƒœçš„ä½ç½®
            const winMove = findWinningMove(2);
            if (winMove) return winMove;
            
            // å†æ£€æŸ¥æ˜¯å¦éœ€è¦é˜²å®ˆï¼ˆç©å®¶å³å°†è·èƒœï¼‰
            const defenseMove = findWinningMove(1);
            if (defenseMove) return defenseMove;
            
            // è¯„ä¼°æ‰€æœ‰å¯èƒ½çš„è½å­ä½ç½®ï¼Œé€‰æ‹©å¾—åˆ†æœ€é«˜çš„
            return getBestMove();
        }
        
        // å¯»æ‰¾èƒ½ç«‹å³è·èƒœçš„ä½ç½®
        function findWinningMove(player) {
            for (let y = 0; y < config.boardSize; y++) {
                for (let x = 0; x < config.boardSize; x++) {
                    if (gameState.board[y][x] === 0) {
                        // å°è¯•è½å­
                        gameState.board[y][x] = player;
                        
                        // æ£€æŸ¥æ˜¯å¦è·èƒœ
                        const isWin = checkWin(x, y, player);
                        
                        // æ’¤é”€å°è¯•
                        gameState.board[y][x] = 0;
                        
                        if (isWin) {
                            return [x, y];
                        }
                    }
                }
            }
            return null;
        }
        
        // å¯»æ‰¾æœ‰æ½œåŠ›çš„è¿›æ”»ä½ç½®
        function findOffensiveMove() {
            // ç®€å•è¯„ä¼°ï¼šå¯»æ‰¾èƒ½å½¢æˆ4è¿ç çš„ä½ç½®
            for (let y = 0; y < config.boardSize; y++) {
                for (let x = 0; x < config.boardSize; x++) {
                    if (gameState.board[y][x] === 0) {
                        // å°è¯•è½å­
                        gameState.board[y][x] = 2;
                        
                        // æ£€æŸ¥æ˜¯å¦èƒ½å½¢æˆ4è¿ç ï¼ˆä¸‹ä¸€æ­¥å¯èƒ½è·èƒœï¼‰
                        if (evaluatePosition(x, y, 2) >= 100) {
                            // æ’¤é”€å°è¯•
                            gameState.board[y][x] = 0;
                            return [x, y];
                        }
                        
                        // æ’¤é”€å°è¯•
                        gameState.board[y][x] = 0;
                    }
                }
            }
            
            // å¯»æ‰¾ä¸­å¿ƒåŒºåŸŸçš„ä½ç½®
            return getRandomMoveNearCenter();
        }
        
        // è¯„ä¼°ä½ç½®çš„ä»·å€¼
        function evaluatePosition(x, y, player) {
            let score = 0;
            
            // æ£€æŸ¥å››ä¸ªæ–¹å‘
            const directions = [
                [1, 0],  // æ°´å¹³
                [0, 1],  // å‚ç›´
                [1, 1],  // å¯¹è§’çº¿
                [1, -1]  // åå¯¹è§’çº¿
            ];
            
            for (const [dx, dy] of directions) {
                // è®¡ç®—å½“å‰æ–¹å‘ä¸Šè¿ç»­çš„æ£‹å­æ•°é‡
                let count = 1;  // å½“å‰ä½ç½®å·²æœ‰ä¸€ä¸ªæ£‹å­
                
                // æ­£æ–¹å‘
                for (let i = 1; i < 5; i++) {
                    const nx = x + dx * i;
                    const ny = y + dy * i;
                    if (nx < 0 || nx >= config.boardSize || ny < 0 || ny >= config.boardSize) break;
                    if (gameState.board[ny][nx] !== player) break;
                    count++;
                }
                
                // åæ–¹å‘
                for (let i = 1; i < 5; i++) {
                    const nx = x - dx * i;
                    const ny = y - dy * i;
                    if (nx < 0 || nx >= config.boardSize || ny < 0 || ny >= config.boardSize) break;
                    if (gameState.board[ny][nx] !== player) break;
                    count++;
                }
                
                // æ ¹æ®è¿ç»­æ£‹å­æ•°é‡ç»™äºˆåˆ†æ•°
                if (count >= 5) score += 10000;  // äº”å­è¿ç ï¼Œæœ€é«˜åˆ†æ•°
                else if (count === 4) score += 1000;  // å››å­ï¼Œé«˜åˆ†
                else if (count === 3) score += 100;   // ä¸‰å­ï¼Œä¸­ç­‰åˆ†æ•°
                else if (count === 2) score += 10;    // äºŒå­ï¼Œä½åˆ†
            }
            
            return score;
        }
        
        // å¯»æ‰¾æœ€ä½³è½å­ä½ç½®ï¼ˆç”¨äºå›°éš¾éš¾åº¦ï¼‰
        function getBestMove() {
            let bestScore = -1;
            let bestMove = null;
            
            // åªæ£€æŸ¥æœ‰æ£‹å­é™„è¿‘çš„ä½ç½®ï¼Œå‡å°‘è®¡ç®—é‡
            const candidates = getCandidateMoves();
            
            for (const [x, y] of candidates) {
                // å°è¯•è½å­
                gameState.board[y][x] = 2;
                
                // è¯„ä¼°è¿™ä¸ªä½ç½®çš„ä»·å€¼
                const score = evaluatePosition(x, y, 2);
                
                // æ’¤é”€å°è¯•
                gameState.board[y][x] = 0;
                
                // å¦‚æœåˆ†æ•°æ›´é«˜ï¼Œæ›´æ–°æœ€ä½³ä½ç½®
                if (score > bestScore) {
                    bestScore = score;
                    bestMove = [x, y];
                }
            }
            
            // å¦‚æœæ²¡æœ‰æ‰¾åˆ°å¥½çš„ä½ç½®ï¼Œè¿”å›éšæœºä½ç½®
            return bestMove || getRandomMoveNearCenter();
        }
        
        // è·å–å€™é€‰è½å­ä½ç½®ï¼ˆæœ‰æ£‹å­é™„è¿‘çš„ä½ç½®ï¼‰
        function getCandidateMoves() {
            const candidates = new Set();
            
            // éå†æ£‹ç›˜ï¼Œæ‰¾åˆ°æœ‰æ£‹å­çš„ä½ç½®
            for (let y = 0; y < config.boardSize; y++) {
                for (let x = 0; x < config.boardSize; x++) {
                    if (gameState.board[y][x] !== 0) {
                        // æ·»åŠ å‘¨å›´çš„ç©ºä½ä½œä¸ºå€™é€‰
                        for (let dy = -2; dy <= 2; dy++) {
                            for (let dx = -2; dx <= 2; dx++) {
                                const nx = x + dx;
                                const ny = y + dy;
                                if (nx >= 0 && nx < config.boardSize && ny >= 0 && ny < config.boardSize && gameState.board[ny][nx] === 0) {
                                    candidates.add(`${nx},${ny}`);
                                }
                            }
                        }
                    }
                }
            }
            
            // å¦‚æœè¿˜æ²¡æœ‰æ£‹å­ï¼Œè¿”å›ä¸­å¿ƒé™„è¿‘çš„ä½ç½®
            if (candidates.size === 0) {
                const center = Math.floor(config.boardSize / 2);
                for (let dy = -1; dy <= 1; dy++) {
                    for (let dx = -1; dx <= 1; dx++) {
                        const nx = center + dx;
                        const ny = center + dy;
                        candidates.add(`${nx},${ny}`);
                    }
                }
            }
            
            // è½¬æ¢ä¸ºåæ ‡æ•°ç»„
            return Array.from(candidates).map(coord => {
                const [x, y] = coord.split(',').map(Number);
                return [x, y];
            });
        }
        
        // è·å–éšæœºè½å­ä½ç½®
        function getRandomMove() {
            const emptyCells = [];
            
            // æ”¶é›†æ‰€æœ‰ç©ºä½
            for (let y = 0; y < config.boardSize; y++) {
                for (let x = 0; x < config.boardSize; x++) {
                    if (gameState.board[y][x] === 0) {
                        emptyCells.push({x, y});
                    }
                }
            }
            
            // å¦‚æœæœ‰ç©ºæ ¼ï¼Œéšæœºé€‰æ‹©ä¸€ä¸ª
            if (emptyCells.length > 0) {
                const randomIndex = Math.floor(Math.random() * emptyCells.length);
                return [emptyCells[randomIndex].x, emptyCells[randomIndex].y];
            }
            
            // æ£‹ç›˜å·²æ»¡ï¼ˆç†è®ºä¸Šä¸ä¼šèµ°åˆ°è¿™é‡Œï¼Œå› ä¸ºä¼šå…ˆåˆ¤æ–­å¹³å±€ï¼‰
            return [0, 0];
        }
        
        // è·å–ä¸­å¿ƒé™„è¿‘çš„éšæœºä½ç½®
        function getRandomMoveNearCenter() {
            const center = Math.floor(config.boardSize / 2);
            const radius = config.difficulty === 3 ? 3 : 5; // å›°éš¾éš¾åº¦èŒƒå›´æ›´å°
            const candidates = [];
            
            // æ”¶é›†ä¸­å¿ƒé™„è¿‘çš„ç©ºä½
            for (let y = Math.max(0, center - radius); y <= Math.min(config.boardSize - 1, center + radius); y++) {
                for (let x = Math.max(0, center - radius); x <= Math.min(config.boardSize - 1, center + radius); x++) {
                    if (gameState.board[y][x] === 0) {
                        candidates.push({x, y});
                    }
                }
            }
            
            // å¦‚æœæœ‰å€™é€‰ä½ç½®ï¼Œéšæœºé€‰æ‹©ä¸€ä¸ª
            if (candidates.length > 0) {
                const randomIndex = Math.floor(Math.random() * candidates.length);
                return [candidates[randomIndex].x, candidates[randomIndex].y];
            }
            
            // å¦åˆ™è¿”å›ä»»æ„éšæœºä½ç½®
            return getRandomMove();
        }
        
        // æ£€æŸ¥æ˜¯å¦è·èƒœ
        function checkWin(x, y, player) {
            // æ£€æŸ¥å››ä¸ªæ–¹å‘
            const directions = [
                [1, 0],  // æ°´å¹³
                [0, 1],  // å‚ç›´
                [1, 1],  // å¯¹è§’çº¿
                [1, -1]  // åå¯¹è§’çº¿
            ];
            
            for (const [dx, dy] of directions) {
                let count = 1;  // å½“å‰ä½ç½®å·²æœ‰ä¸€ä¸ªæ£‹å­
                
                // æ­£æ–¹å‘
                for (let i = 1; i < 5; i++) {
                    const nx = x + dx * i;
                    const ny = y + dy * i;
                    if (nx < 0 || nx >= config.boardSize || ny < 0 || ny >= config.boardSize) break;
                    if (gameState.board[ny][nx] !== player) break;
                    count++;
                }
                
                // åæ–¹å‘
                for (let i = 1; i < 5; i++) {
                    const nx = x - dx * i;
                    const ny = y - dy * i;
                    if (nx < 0 || nx >= config.boardSize || ny < 0 || ny >= config.boardSize) break;
                    if (gameState.board[ny][nx] !== player) break;
                    count++;
                }
                
                // å¦‚æœæœ‰äº”ä¸ªæˆ–æ›´å¤šè¿ç»­çš„æ£‹å­ï¼Œè·èƒœ
                if (count >= 5) {
                    return true;
                }
            }
            
            return false;
        }
        
        // æ›´æ–°æ¸¸æˆçŠ¶æ€æ˜¾ç¤º
        function updateGameStatus(message = '') {
            if (message) {
                elements.gameStatus.textContent = message;
            } else {
                elements.gameStatus.textContent = gameState.currentPlayer === 1 ? 
                    'ä½ çš„å›åˆ' : 'ç”µè„‘å›åˆ';
            }
        }
        
        // æ˜¾ç¤ºèƒœåˆ©ä¿¡æ¯
        function showVictoryMessage(isPlayerWin) {
            // æ’­æ”¾èƒœåˆ©éŸ³æ•ˆ
            playSound(elements.winSound);
            
            // è®¾ç½®èƒœåˆ©æ–‡æœ¬
            elements.victoryText.textContent = isPlayerWin ? 'å¤ªç‰›äº†å¾—è´ºè´º' : 'é²æ€»è¯´æ‹‰å¤§èƒ¯';
            
            // æ˜¾ç¤ºèƒœåˆ©ä¿¡æ¯
            elements.victoryMessage.classList.remove('hidden');
            
            // æ›´æ–°æ¸¸æˆçŠ¶æ€
            updateGameStatus(isPlayerWin ? 'ä½ èµ¢äº†ï¼' : 'ç”µè„‘èµ¢äº†ï¼');
        }
        
        // æ’­æ”¾éŸ³æ•ˆ
        function playSound(audioElement) {
            if (config.soundEnabled && audioElement.src) {
                // å…‹éš†éŸ³é¢‘å…ƒç´ ä»¥å…è®¸è¿ç»­æ’­æ”¾
                const clone = audioElement.cloneNode();
                clone.play().catch(e => console.log('æ’­æ”¾éŸ³æ•ˆå¤±è´¥:', e));
            }
        }
        
        // åˆ‡æ¢éŸ³æ•ˆ
        function toggleSound() {
            config.soundEnabled = !config.soundEnabled;
            
            // æ›´æ–°å›¾æ ‡
            elements.soundBtn.innerHTML = config.soundEnabled ? 
                '<i class="fa fa-volume-up text-xl"></i>' : 
                '<i class="fa fa-volume-off text-xl"></i>';
            
            // æ§åˆ¶èƒŒæ™¯éŸ³ä¹
            if (config.soundEnabled) {
                elements.coverMusic.play().catch(e => {});
                elements.gameMusic.play().catch(e => {});
            } else {
                elements.coverMusic.pause();
                elements.gameMusic.pause();
            }
        }
        
        // æ‚”æ£‹
        function undoMove() {
            // å¦‚æœæ¸¸æˆç»“æŸæˆ–æ²¡æœ‰å†å²è®°å½•ï¼Œä¸èƒ½æ‚”æ£‹
            if (gameState.gameOver || gameState.history.length < 2) {
                return;
            }
            
            // æ’¤é”€ä¸¤æ­¥ï¼ˆç©å®¶å’Œç”µè„‘å„ä¸€æ­¥ï¼‰
            for (let i = 0; i < 2; i++) {
                if (gameState.history.length === 0) break;
                
                const lastMove = gameState.history.pop();
                gameState.board[lastMove.y][lastMove.x] = 0;
            }
            
            // é‡æ–°æ¸²æŸ“æ£‹ç›˜
            renderBoard();
            
            // ç¡®ä¿å½“å‰æ˜¯ç©å®¶å›åˆ
            gameState.currentPlayer = 1;
            gameState.gameOver = false;
            
            // æ›´æ–°æ¸¸æˆçŠ¶æ€
            updateGameStatus();
            
            // éšè—èƒœåˆ©ä¿¡æ¯
            elements.victoryMessage.classList.add('hidden');
        }
        
        // äº‹ä»¶ç›‘å¬
        function setupEventListeners() {
            // å¼€å§‹æ¸¸æˆæŒ‰é’®
            elements.startBtn.addEventListener('click', () => {
                elements.cover.classList.add('opacity-0');
                setTimeout(() => {
                    elements.cover.classList.add('hidden');
                    elements.game.classList.remove('hidden');
                    
                    // åˆ‡æ¢èƒŒæ™¯éŸ³ä¹
                    elements.coverMusic.pause();
                    elements.gameMusic.play().catch(e => {});
                }, 1000);
            });
            
            // è¿”å›æŒ‰é’®
            elements.backBtn.addEventListener('click', () => {
                elements.gameBoardContainer.classList.add('hidden');
                elements.difficultySelect.classList.remove('hidden');
            });
            
            // éŸ³æ•ˆæŒ‰é’®
            elements.soundBtn.addEventListener('click', toggleSound);
            
            // é‡æ–°å¼€å§‹æŒ‰é’®
            elements.restartBtn.addEventListener('click', () => {
                initGame();
            });
            
            // éš¾åº¦é€‰æ‹©æŒ‰é’®
            elements.difficultyBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    // è®¾ç½®éš¾åº¦
                    config.difficulty = parseInt(btn.dataset.level);
                    
                    // åˆå§‹åŒ–æ¸¸æˆ
                    initGame();
                    
                    // æ˜¾ç¤ºæ¸¸æˆæ£‹ç›˜ï¼Œéšè—éš¾åº¦é€‰æ‹©
                    elements.difficultySelect.classList.add('hidden');
                    elements.gameBoardContainer.classList.remove('hidden');
                });
            });
            
            // å†æ¥ä¸€å±€æŒ‰é’®
            elements.playAgainBtn.addEventListener('click', () => {
                initGame();
            });
            
            // æ‚”æ£‹æŒ‰é’®
            elements.undoBtn.addEventListener('click', undoMove);
            
            // æ›´æ¢éš¾åº¦æŒ‰é’®
            elements.changeDifficultyBtn.addEventListener('click', () => {
                elements.gameBoardContainer.classList.add('hidden');
                elements.difficultySelect.classList.remove('hidden');
            });
            
            // çª—å£å¤§å°å˜åŒ–æ—¶é‡æ–°è®¡ç®—æ£‹ç›˜
            window.addEventListener('resize', () => {
                if (!elements.gameBoardContainer.classList.contains('hidden')) {
                    calculateCellSize();
                    renderBoard();
                }
            });
        }
        
        // åˆå§‹åŒ–
        function init() {
            setupEventListeners();
            
            // å°è¯•æ’­æ”¾å°é¢éŸ³ä¹
            elements.coverMusic.play().catch(e => {});
        }
        
        // å¯åŠ¨æ¸¸æˆ
        init();
    </script>
</body>
</html>
